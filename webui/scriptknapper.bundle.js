!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.scriptknapper=e():t.scriptknapper=e()}(this,(function(){return(()=>{"use strict";var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{buildTemplateJSON:()=>h,prepareTemplateString:()=>u,scriptKnapperMain:()=>m});const r=function(t,e="",r=""){let n="TRANSPILATION ERROR\n\nError while transpiling script from provided JSON:\n\n";return n+=t+"\n\n",""!==e&&(n+="Error occurred in the following template: "+e,n+=""===r?"\n\n":"\n"),""!==r&&(n+="Error occurred with the following markup data: "+r,n+="\n\n"),n+="Please correct these issues with the provided JSON, and then try again.",n},n=function(t,e){try{if(!t.hasOwnProperty("template"))throw"The given template call has not been given a template property.";let r=t.template,n=e.filter((t=>t.name===r));if(0===n.length)throw"The given template name ("+r+") is not recognised.";if(n.length>1)throw"The given template name ("+r+") has more than one match.";if(t.hasOwnProperty("data")&&!Array.isArray(t.data))throw"The provided data to the "+t.template+" template is not in an array."}catch(t){return[!0,r("Encountered a problem parsing the provided markup JSON: "+t)]}return[!1,""]},a=function(t){let e={};for(let r=0;r<t.length;r++)e={...t[r],...e};return e},o=function(t,e="{",r="}"){if(!t.startsWith(e))return-1;let n=0,a=0;for(;a<t.length;){if(t.substr(a,e.length)==e)n++;else if(t.substr(a,r.length)==r&&(n--,0===n))return a+r.length;a++}return-1},i=function(t,e){let r,n="ScriptKnapper encountered an issue when attempting to add data from a template to the data object: ",i=e;for(;i.includes("{+");){r=i.indexOf("{+");let e,l=o(i.substring(r,i.length),"{+","+}");if(l<0)return[!0,n+"Data addition tag was not properly closed."];try{e=JSON.parse("{"+i.substring(r+2,r+l-2)+"}")}catch(t){return[!0,n+t]}t=a([e,t]),i=i.substring(r+l,i.length)}return[!1,t]},l=function(t){let e,r;for(;t.includes("{+");){if(e=t.indexOf("{+"),r=o(t.substring(e,t.length),"{+","+}"),r<0)return[!0,"ScriptKnapper encountered an issue when attempting to add data from a template to the data object: Data addition tag was not properly closed."];t=t.substring(0,e)+t.substring(e+r)}return[!1,t]},p=function(t,e,n){let a,i,l=n,p=!1,s=0;for(;l.substring(s).includes("{:");){i=s+l.substring(s).indexOf("{:");try{let e;if(a="ScriptKnapper encountered an issue when attempting to resolve a call to the requested data: ","{"===l.charAt(i-1)){if(e=o(l.substring(i-1),"{{:",":}}"),-1===e)throw"Encountered an incorrectly formatted call to a template.";s=i+e}else{if(e=o(l.substring(i),"{:",":}"),-1===e)throw"Encountered an incomplete call to a data property.";let r=l.substring(i+2,i+e-2).trim();if(!t.hasOwnProperty(r))throw"Encountered a call to a property ("+r+") that hasn't been passed to the template.";if("string"!=typeof t[r])throw"Encountered a call to a property ("+r+") that did not contain a string.";l=l.substring(0,i)+t[r]+l.substring(i+e)}}catch(n){l=r(a+n,e,JSON.stringify(t)),p=!0;break}}return[p,l]},s=function(t,e,n){let i,l,p="Error handling embedded template call: ";for(;(i=t.indexOf("{{:"))>-1;){if(l=o(t.substring(i),"{{:",":}}"),-1===l)return[!0,r(p+"Embedded template object is invalid or incomplete.","Unable to determine the template called within an embedded template call.",JSON.stringify(e))];{let o;try{o=JSON.parse("{"+t.substring(i+3,i+l-3)+"}")}catch(t){return[!0,r(p+"Embedded template object is invalid.","Unable to determine the template called within an embedded template call.",JSON.stringify(e))]}let s={template:o.template,data:[]};for(let t=0;t<o.data.length;t++)s.data[t]=a([o.data[t],e]);let[d,c]=f([s],n);if(d)return[!0,c];t=t.substring(0,i)+c+t.substring(i+l)}}return[!1,t]},d=function(t,e,n){let a="",o="No data JSON is available for this exception.",d="Error when attempting to feed data into a template: ";try{for(let r=0;r<e.data.length;r++){o=JSON.stringify([e.data[r]]);let[f,c]=i(e.data[r],t.template);if(f)return[!0,c];e.data[r]=c;let[m,u]=l(t.template);if(m)return[!0,u];let[h,g]=p(e.data[r],t.name,u);if(h)return[!0,g];d="Encountered a problem parsing a call to an embedded template: ";const[b,y]=s(g,e.data[r],n);if(b)return[!0,y];a+=y}}catch(e){return[!0,r(d+e,t.name,o)]}return[!1,a]},f=function(t,e){let a,o,i="",l="";try{for(let r=0;r<t.length;r++){let[p,s]=n(t[r],e);if(p)return[!0,s];o=e.filter((e=>e.name===t[r].template))[0],l=o.name,a=t[r].data,t[r].hasOwnProperty("data")&&0!==t[r].data.length||(t[r].data=[{}]);let[f,c]=d(o,t[r],e);if(f)return[!0,c];i+=c}}catch(t){return[!0,r("Error when generating a markup object's instructions: "+t,l,JSON.stringify(a))]}return[!1,i]},c=function(t,e){let r;for(let n=0;n<e.length;n++){const a=e[n].from.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");r=new RegExp(a,"gi"),t=t.replace(r,e[n].to)}return t},m=function(t,e){let n,a,o,i="";try{n="Encountered a problem parsing the provided template JSON: ",o=JSON.parse(e),n="Encountered a problem parsing the provided markup JSON: ",a=JSON.parse(t);let[r,l]=f(a,o);if(r)return[!0,l];i=l}catch(t){return[!0,r(n+t,"No template name is available for this error.","No data JSON is available for this error.")]}return i=c(i,[{from:"@ohb:",to:"{:"},{from:"@chb:",to:":}"},{from:"@odhb:",to:"{{:"},{from:"@cdhb:",to:":}}"},{from:"@ohb+",to:"{+"},{from:"@chb+",to:"+}"}]),[!1,i]},u=function(t,e="none",r=!1,n=!1){let a=[];return"none"!==e&&("remove"===e?a.push({from:"\t",to:""},{from:"\v",to:""},{from:"\r",to:""},{from:"\n",to:""}):"spaceReplace"===e?a.push({from:"\t",to:" "},{from:"\v",to:" "},{from:"\r",to:" "},{from:"\n",to:" "}):"escapeCodeReplace"===e&&a.push({from:"\t",to:String.raw`\t`},{from:"\v",to:String.raw`\v`},{from:"\r",to:String.raw`\r`},{from:"\n",to:String.raw`\n`})),r&&a.push({from:'"',to:String.raw`\"`}),n&&a.push({from:"{{:",to:"@odhb:"},{from:":}}",to:"@cdhb:"},{from:"{:",to:"@ohb:"},{from:":}",to:"@chb:"},{from:"{+",to:"@ohb+"},{from:"+}",to:"@chb+"}),c(t,a)},h=function(t,e=!1){let r="[";return t.forEach((t=>{let n=t.template;e||(n=c(n,[{from:"\t",to:String.raw`\t`},{from:"\v",to:String.raw`\v`},{from:"\r",to:String.raw`\r`},{from:"\n",to:String.raw`\n`},{from:'"',to:String.raw`\"`}])),"}"===r.charAt(r.length-1)&&(r+=","),r+='\n\t{ "name": "'+t.templateName+'", "template": "'+n+'" }'})),r+"\n]"};return e})()}));